# ğŸš€ Rust é€šç”¨"æ–‡ä»¶ â†’ Markdown"æ¡†æ¶

## ç³»ç»Ÿæ¶æ„æµç¨‹å›¾

```mermaid
flowchart TD
    A[file_input] --> B[detect format]
    B --> C[parser::docx<br/>æ–‡å­— + æ®µè½ + è¡¨æ ¼ + å›¾ç‰‡]
    B --> D[parser::xlsx<br/>è¡¨æ ¼ + å›¾ç‰‡]
    B --> E[parser::pdf<br/>æ–‡å­— / åæ ‡æ–‡æœ¬ / å›¾ç‰‡]
    B --> F[parser::image<br/>å›¾ç‰‡]

    C --> G[ç»Ÿä¸€ AST Document]
    D --> G
    E --> G
    F --> G

    G --> H[OCR æ¨¡å—<br/>å›¾ç‰‡ â†’ æ–‡æœ¬]
    G --> I[Vision æ¨¡å—<br/>å›¾ç‰‡ â†’ å›¾åƒæè¿°]

    H --> J[renderer::markdown<br/>AST â†’ Markdown æ–‡æ¡£]
    I --> J
```

### æ•°æ®æµè½¬è¿‡ç¨‹

1. **æ–‡ä»¶è¾“å…¥** â†’ æ ¼å¼æ£€æµ‹
2. **è§£æå™¨æ¨¡å—**ï¼š
   - `parser::docx` - å¤„ç†æ–‡å­— + æ®µè½ + è¡¨æ ¼ + å›¾ç‰‡
   - `parser::xlsx` - å¤„ç†è¡¨æ ¼ + å›¾ç‰‡
   - `parser::pdf` - å¤„ç†æ–‡å­— / åæ ‡æ–‡æœ¬ / å›¾ç‰‡
   - `parser::image` - å¤„ç†å›¾ç‰‡
3. **ç»Ÿä¸€ AST** (Document)
4. **å¢å¼ºå¤„ç†**ï¼š
   - OCR æ¨¡å— (å›¾ç‰‡ â†’ æ–‡æœ¬)
   - Vision æ¨¡å— (å›¾ç‰‡ â†’ å›¾åƒæè¿°)
5. **æ¸²æŸ“è¾“å‡º** â†’ Markdown æ–‡æ¡£

### æ ¸å¿ƒ AST ç»“æ„

```rust
Document {
    blocks: Vec<Block>,
}

// æ”¯æŒçš„å—ç±»å‹ï¼š
Block::Paragraph(String)
Block::Heading(level, String)
Block::Table(TableData)
Block::Image { path, ocr, caption }
```

## ğŸ§© æ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚

```rust
#[derive(Debug)]
pub struct Document {
    pub blocks: Vec<Block>,
}

#[derive(Debug)]
pub enum Block {
    Heading { level: u8, text: String },
    Paragraph(String),
    Table(TableData),
    Image {
        path: String,
        ocr_text: Option<String>,
        vision_desc: Option<String>,
    },
}

#[derive(Debug)]
pub struct TableData {
    pub rows: Vec<Vec<String>>,
}
```

## ğŸ—ï¸ é¡¹ç›®ç›®å½•ç»“æ„

```text
src/
â”œâ”€â”€ main.rs                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ lib.rs                  # åº“å…¥å£æ–‡ä»¶
â”œâ”€â”€ parser/                 # è§£æå™¨æ¨¡å—
â”‚   â”œâ”€â”€ mod.rs             # è§£æå™¨æ¨¡å—å®šä¹‰
â”‚   â”œâ”€â”€ docx.rs            # Word æ–‡æ¡£è§£æ
â”‚   â”œâ”€â”€ xlsx.rs            # Excel è¡¨æ ¼è§£æ
â”‚   â”œâ”€â”€ pdf.rs             # PDF æ–‡æ¡£è§£æ
â”‚   â””â”€â”€ image.rs           # å›¾ç‰‡æ–‡ä»¶è§£æ
â”œâ”€â”€ ocr/                   # OCR æ–‡å­—è¯†åˆ«æ¨¡å—
â”‚   â”œâ”€â”€ mod.rs
â”‚   â””â”€â”€ paddleocr.rs       # PaddleOCR é›†æˆ
â”œâ”€â”€ vision/                # è§†è§‰ç†è§£æ¨¡å—
â”‚   â”œâ”€â”€ mod.rs
â”‚   â””â”€â”€ openai.rs          # OpenAI Vision API é›†æˆ
â”œâ”€â”€ renderer/              # æ¸²æŸ“è¾“å‡ºæ¨¡å—
â”‚   â”œâ”€â”€ mod.rs
â”‚   â””â”€â”€ markdown.rs        # Markdown æ ¼å¼è¾“å‡º
â”œâ”€â”€ model/                 # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ mod.rs
â”‚   â””â”€â”€ ast.rs             # AST æ•°æ®ç»“æ„
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
    â””â”€â”€ file.rs            # æ–‡ä»¶æ“ä½œå·¥å…·
```

## åŠŸèƒ½ç‰¹æ€§

- **å¤šæ ¼å¼æ”¯æŒ**: DOCX, XLSX, PDF, å›¾ç‰‡æ–‡ä»¶
- **æ™ºèƒ½è§£æ**: è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶æ ¼å¼å¹¶é€‰æ‹©å¯¹åº”è§£æå™¨
- **OCR é›†æˆ**: å›¾ç‰‡ä¸­çš„æ–‡å­—è‡ªåŠ¨è¯†åˆ«æå–
- **è§†è§‰ç†è§£**: AI å›¾åƒæè¿°ç”Ÿæˆ
- **ç»Ÿä¸€è¾“å‡º**: æ ‡å‡† Markdown æ ¼å¼è¾“å‡º
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„æ¶æ„ï¼Œæ˜“äºæ‰©å±•ç»´æŠ¤
